!function(a,b,c,d){function e(b,c){return this.element=b,this.$element=a(b),this.options=a.extend({},g,c),this._defaults=g,this._name=f,this._zoom=5,this._layerCount=0,this._dragging=!1,this._highestLayer=1,this._layerUsage=[],this._addTimelinesArray=[],this.init(),5!=this.options.zoom&&this.setZoom(this.options.zoom),this}var f="multiTimeline",g={start:moment().subtract(7,"days").format("YYYY-MM-DD"),end:moment().add(7,"days").format("YYYY-MM-DD"),xAxisDateFormat:"DD/MM",xAxisUnit:"days",markerDateFormat:"YYYY-MM-DD HH:mm",timelineSpacing:30,zoomStep:1,zoom:5,flatten:!1,maxLabelCount:20,infinity:"9999-12-31",dawn:"0000-01-01",data:[],mousewheelPan:!0,mousewheelZoom:!0,allDraggable:!0,allResizeable:!0,gridPrecision:15,onTimelineClick:function(a,b){},onZoomChange:function(a){},onDragEnd:function(a,b){},onResizeEnd:function(a,b){},onEdit:function(a,b){},zoomInControl:null,zoomOutControl:null,goLeftControl:null,goRightControl:null};e.prototype={SECONDS_PER_DAY:86400,DAYS_PER_WEEK:7,init:function(){return null===this.options.start||null===this.options.end?(console.error("multi-timeline.js: start or end date is missing!"),!1):(this._startMoment=moment(this.options.start),this._endMoment=moment(this.options.end),this._endMoment.isAfter(this._startMoment)?(this._secondsCount=this.getDuration(this._startMoment,this._endMoment),this._daysCount=this._secondsCount/this.SECONDS_PER_DAY,this._weeksCount=this._daysCount/this.DAYS_PER_WEEK,this._percentagePerDay=100/(this._daysCount+1),this._percentagePerWeek=100/(this._weeksCount+1),this._unitCount="days"===this.options.xAxisUnit?this._daysCount:this._weeksCount,this._unitPercentage="days"===this.options.xAxisUnit?this._percentagePerDay:this._percentagePerWeek,this._timelineCount=this.options.data.length,void this.createStructure().addTimelines().addEventHandlers().setWrapperDimensions().setReady()):(console.error("multi-timline.js: end date has to be a date after start date!"),!1))},setReady:function(){return this.$element.addClass("is-ready"),this},createStructure:function(){return this.$element.addClass("tl-wrapper"),this.addMarks(),this},addMarks:function(){for(var b="days"===this.options.xAxisUnit?"day":"week",c=this._startMoment,d=this._endMoment.add(1,"day"),e=a('<ul class="tl-time">'),f=-1,g="",h=[];!c.isAfter(d,b);){f++,c=c.add(1,b),g=c,this._unitCount>10&&f%Math.round(this._unitCount/this.options.maxLabelCount)!=0&&(g="");var i=c.isSame(new Date,b);h.push(this.createTimeUnit(g,f+1,i))}e.append(h.reverse()).appendTo(this.$element)},createTimeUnit:function(b,c,d){moment.isMoment(b)&&(b=this.getLabelText(b));var e=a('<li class="tl-time__unit">').html(b).css({left:c*this._unitPercentage+"%"}).append("<span>");return d&&e.addClass("is-today"),e},getLabelText:function(a){var b=this.options.xAxisDateFormat;if(-1===b.indexOf("\n"))return a.format(b);var c=b.split("\n"),d=[];return c.forEach(function(b){d.push(a.format(b))}),d.join("<br />")},getDuration:function(a,b){return moment.duration(b.diff(a)).asSeconds()},getDraggingStatus:function(){return this._dragging},addTimelines:function(){var b=this;return a(this.options.data).each(function(a){this.key=a,b.addTimeline(this,0)}),this.$element.prepend(this._addTimelinesArray.reverse()),this},addTimeline:function(b){var c,e,f=this,g=[];b=this.handleStartAndEndDates(b);var h={start:b.start==this.options.dawn,end:b.end==this.options.infinity};b.layer===d?(e=!0!==this.options.flatten?this._layerCount:this.getNextFreeLayer(moment(b.start),moment(b.end)),this._layerCount++,this.options.data[b.key].layer=e):e=b.layer,this._layerUsage.push({layer:e,start:moment(b.start),end:moment(b.end)}),b.hasPhases=!1,b.hasOwnProperty("phases")&&b.phases.length>0&&(g.push("tl-has-phases"),this.options.allDraggable=!1,this.options.allResizeable=!1,b.hasPhases=!0,b.phases.forEach(function(a){a.key=b.key,a.layer=e,f.addTimeline(a)}));var i={};i.seconds=this.getDuration(moment(b.start),moment(b.end)),i.days=i.seconds/this.SECONDS_PER_DAY,i.weeks=i.days/this.DAYS_PER_WEEK,0===i.seconds&&g.push("tl-point");var j={};j.seconds=this.getDuration(moment(this.options.start),moment(b.start)),j.days=j.seconds/this.SECONDS_PER_DAY,j.weeks=j.days/this.DAYS_PER_WEEK;j.seconds<0&&(i.seconds=i.seconds+j.seconds,i.days=i.seconds/this.SECONDS_PER_DAY,i.weeks=i.days/this.DAYS_PER_WEEK,j.days=j.seconds=0,g.push("tl-overflow-left"));var k=i[this.options.xAxisUnit]*this._unitPercentage;k>100&&(k=100),j.days+i.days>this._daysCount+1&&g.push("tl-overflow-right");var l=j[this.options.xAxisUnit]*this._unitPercentage;l>100&&(l=100);var m=i.seconds<0?"hidden":"visible";b.title=b.title!==d?b.title:"",b.class!==d&&g.push(b.class),a.isArray(b.color)&&g.push("has-color-bars");var n={width:k+"%",left:l+"%",visibility:m,bottom:e*this.options.timelineSpacing+20+"px","z-index":b.zIndex!==d?b.zIndex:10,"background-color":b.color===d||a.isArray(b.color)?null:b.color},o=a('<div class="tl-timeline">').html(this.getTimelineHtml(b)).css(n).addClass(g.join(" ")).attr({"data-tl-start-offset":j.seconds,"data-tl-duration":i.seconds,"data-tl-start":b.start,"data-tl-end":b.end,"data-tl-identifier":b.key,"data-tl-layer":e,title:b.title}).on("click",function(a){!0!==f._dragging&&f.options.onTimelineClick(a,b)}).on("mouseenter",function(){clearTimeout(c),a(this).addClass("is-hovered")}).on("mouseleave",function(){var b=a(this);b.hasClass("is-dragging")||(c=setTimeout(function(){b.removeClass("is-hovered")},100))});!0!==this.options.allDraggable&&!0!==b.draggable||o.addClass("is-draggable"),!0!==this.options.allResizeable&&!0!==b.resizeable||o.addClass("is-resizeable"),!0===h.start&&o.addClass("is-infinite-start"),!0===h.end&&o.addClass("is-infinite-end"),o.prependTo(this.$element),this._addTimelinesArray.push(o),parseInt(o.outerWidth())<140&&o.find(".tl-timeline__date-end").remove()},getNextFreeLayer:function(b,c){var d=[];this._layerUsage.forEach(function(a){return((a.start.isAfter(b)||a.start.isSame(b))&&(a.start.isBefore(c)||a.start.isSame(c))||(a.end.isAfter(b)||a.end.isSame(b))&&(a.end.isBefore(c)||a.end.isSame(c))||(a.start.isBefore(b)||a.start.isSame(b))&&(a.end.isAfter(c)||a.end.isSame(c)))&&d.push(a.layer),!1});for(var e=0;-1!==a.inArray(e,d);)e++;return e},handleStartAndEndDates:function(a){return a.hasOwnProperty("phases")&&a.phases.length>0&&(a.start=this.getEarliestDate(a.phases),a.end=this.getLatestDate(a.phases)),a.end!==d&&a.end!=this.options.infinity||(a.end=this.options.infinity),a.start!==d&&a.start!=this.options.dawn||(a.start=this.options.dawn),a},getEarliestDate:function(a){var b=moment(this.options.infinity);return a.forEach(function(a){var c=moment(a.start);c.isBefore(b)&&(b=c)}),b},getLatestDate:function(a){var b=moment(this.options.dawn);return a.forEach(function(a){var c=moment(a.end);c.isAfter(b)&&(b=c)}),b},getTimelineHtml:function(b){var c="";return b.hasPhases?'<div class="tl-timeline__phase-line"></div>':(c+='<div class="tl-timeline__resizer tl-timeline__resizer-start"></div>',c+='<div class="tl-timeline__resizer tl-timeline__resizer-end"></div>',a.isArray(b.color)&&b.color.forEach(function(a){c+='<div class="tl-timeline__color-bar" style="background-color: '+a+'"></div>'}),b.start!=this.options.dawn&&!1!==this.options.markerDateFormat&&(c+='<div class="tl-timeline__date-marker tl-timeline__date-start">',c+=moment(b.start).format(this.options.markerDateFormat),c+="</div>"),c+='<div class="tl-timeline__title">'+b.title+"</div>",b.end!=this.options.infinity&&!1!==this.options.markerDateFormat&&(c+='<div class="tl-timeline__date-marker tl-timeline__date-end">',c+=moment(b.end).format(this.options.markerDateFormat),c+="</div>"),c)},setWrapperDimensions:function(){var b=this,c=0,d=this.$element.outerWidth();this.$element.find(".tl-timeline").each(function(){var e=100/d*parseInt(a(this).css("left"));if(e>0&&e<100){var f=a(this).data("tl-layer");f>b._highestLayer&&(b._highestLayer=f),0===c&&(b.timelineHeight=parseInt(a(this).outerHeight()))}});var e=c+(this._highestLayer+2)*this.options.timelineSpacing;return e+=5,this.$element.css("height",e).find(".tl-time__unit span").css({height:e,top:-1*e}),this},addEventHandlers:function(){var d=this;null!==this.options.zoomInControl&&this.options.zoomInControl.on("click",function(a){a.preventDefault(),d.zoomIn()}),null!==this.options.zoomOutControl&&this.options.zoomOutControl.on("click",function(a){a.preventDefault(),d.zoomOut()}),null!==this.options.goRightControl&&this.options.goRightControl.on("click",function(a){a.preventDefault(),d.goRight()}),null!==this.options.goLeftControl&&this.options.goLeftControl.on("click",function(a){a.preventDefault(),d.goLeft()}),!0!==this.options.mousewheelPan&&!0!==this.options.mousewheelZoom||this.$element.on("mousewheel DOMMouseScroll onmousewheel",function(a){a=b.event||a;var c=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));!0===a.ctrlKey&&!0===d.options.mousewheelZoom?c>0?d.zoomIn():d.zoomOut():!0===d.options.mousewheelPan&&(c>0?d.goLeft():d.goRight()),a.preventDefault()});var e={x:0,y:0},f={x:0,y:0,isDragging:!1};return d.$element.on("mousedown",".tl-timeline",function(b){var g=!1;if(a(this).hasClass("is-draggable")&&(g="move"),a(this).hasClass("is-resizeable")&&(a(b.target).hasClass("tl-timeline__resizer-start")||a(this).hasClass("is-infinite-end")?g="w-resize":(a(b.target).hasClass("tl-timeline__resizer-end")||a(this).hasClass("is-infinite-start"))&&(g="e-resize")),!1!==g&&!f.isDragging){f.isDragging=!0;var h=a(this),i={x:b.pageX,y:b.pageY},j={x:0,y:0};f.x=b.pageX,f.y=b.pageY;var k=a(this).parents();k.on("mousemove",function(b){e.x=b.pageX-f.x,e.y=b.pageY-f.y;var c=parseInt(h.data("tl-layer"));if(j.x=i.x-b.pageX,j.y=i.y-b.pageY,!(Math.abs(j.x)<5&&Math.abs(j.y)<5)){if(d.$element.find(".tl-timeline").css("z-index",1e3),a("body").css("cursor",g),h.css({"z-index":1050,cursor:g}).addClass("is-hovered is-dragging"),d._dragging=!0,j.y>d.options.timelineSpacing)h.css("bottom",(c+1)*d.options.timelineSpacing+20+"px"),h.data("tl-layer",c+1),i.y=b.pageY,d.setWrapperDimensions();else if(j.y<-1*d.options.timelineSpacing){var k=c-1;k<0&&(k=0,c=1),h.css("bottom",k*d.options.timelineSpacing+20+"px"),h.data("tl-layer",c-1),i.y=b.pageY,d.setWrapperDimensions()}d.options.data[h.data("tl-identifier")].layer=this._layerCount;var l=h.offset(),m=l.left+e.x,n=parseFloat(h.css("width"));switch(g){case"move":h.offset({left:m});break;case"w-resize":if(n-e.x<50)return;h.offset({left:m}).css("width",n-e.x);break;case"e-resize":if(n+e.x<50)return;h.css("width",n+e.x)}var o=parseInt(h.css("left")),p=100/parseInt(d.$element.innerWidth())*o;d.updateDates(h,d.percentToDate(p)),f.x=b.pageX,f.y=b.pageY}}),a(c).on("mouseup",function(){if(f.isDragging){f.isDragging=!1;var b=parseInt(h.css("left")),e=100/parseInt(d.$element.innerWidth())*b;a("body").css("cursor","default"),h.css({left:e+"%",cursor:"default"}).removeClass("is-dragging is-hovered"),k.off("mousemove"),a(c).off("mouseup"),d._highestLayer=1,d.setWrapperDimensions(),"move"==g?d.options.onDragEnd(h,d):d.options.onResizeEnd(h,d),d._dragging&&d.options.onEdit(h,d),setTimeout(function(){d._dragging=!1},40)}}),b.preventDefault()}}),this},updateDates:function(a,b){a.hasClass("is-infinite-start")&&(b=moment(this.options.dawn));var c=parseInt(a.css("left")),d=100/parseInt(this.$element.innerWidth())*(c+a.outerWidth()),e=a.hasClass("is-infinite-end")?moment(this.options.infinity):this.percentToDate(d);this.options.data[a.data("tl-identifier")].start=b.format("YYYY-MM-DD HH:mm:ss"),this.options.data[a.data("tl-identifier")].end=e.format("YYYY-MM-DD HH:mm:ss"),a.hasClass("is-infinite-start")&&delete this.options.data[a.data("tl-identifier")].start,a.hasClass("is-infinite-end")&&delete this.options.data[a.data("tl-identifier")].end,a.data("tl-duration",this.getDuration(b,e)),!1!==this.options.markerDateFormat&&a.find(".tl-timeline__date-start").html(b.format(this.options.markerDateFormat)),!1!==this.options.markerDateFormat&&a.find(".tl-timeline__date-end").html(e.format(this.options.markerDateFormat))},percentToDate:function(a){var b={days:this.SECONDS_PER_DAY,weeks:this.SECONDS_PER_DAY*this.DAYS_PER_WEEK},c=(this._unitCount+1)/100,d=parseInt(a*c*b[this.options.xAxisUnit]),e=moment(this.options.start).add(d,"seconds"),f=e.get("minute");return e.set("minute",Math.round(f/this.options.gridPrecision)*this.options.gridPrecision),e.set("second",0),e},removeEventHandlers:function(){return null!==this.options.zoomInControl&&this.options.zoomInControl.off("click"),null!==this.options.zoomOutControl&&this.options.zoomOutControl.off("click"),null!==this.options.goRightControl&&this.options.goRightControl.off("click"),null!==this.options.goLeftControl&&this.options.goLeftControl.off("click"),!0!==this.options.mousewheelPan&&!0!==this.options.mousewheelZoom||this.$element.off("mousewheel DOMMouseScroll onmousewheel"),this.$element.off("mousedown",".tl-timeline"),this},setZoom:function(a){if(!(a<0)){var b=this._zoom-a;b>0?this.zoomIn(b):b<0&&this.zoomOut(Math.abs(b))}},zoomOut:function(a){a===d&&(a=1),this.options.start=moment(this.options.start).subtract(a*this.options.zoomStep,"days").format("YYYY-MM-DD"),this.options.end=moment(this.options.end).add(a*this.options.zoomStep,"days").format("YYYY-MM-DD"),this._zoom=this._zoom+a,this.options.onZoomChange(this._zoom),this.redraw()},zoomIn:function(a){a===d&&(a=1);var b=moment(this.options.start).add(a*this.options.zoomStep,"days"),c=moment(this.options.end).subtract(a*this.options.zoomStep,"days");b.isBefore(c)&&(this.options.start=b.format("YYYY-MM-DD"),this.options.end=c.format("YYYY-MM-DD"),this._zoom=this._zoom-a,this.options.onZoomChange(this._zoom),this.redraw())},goRight:function(){var a=Math.ceil(this._unitCount/12);this.options.start=moment(this.options.start).add(a,this.options.xAxisUnit).format("YYYY-MM-DD"),this.options.end=moment(this.options.end).add(a,this.options.xAxisUnit).format("YYYY-MM-DD"),this.redraw()},goLeft:function(){var a=Math.ceil(this._unitCount/12);this.options.start=moment(this.options.start).subtract(a,this.options.xAxisUnit).format("YYYY-MM-DD"),this.options.end=moment(this.options.end).subtract(a,this.options.xAxisUnit).format("YYYY-MM-DD"),this.redraw()},reset:function(){return this.$element.html(""),this._layerCount=0,this._layerUsage=[],this._addTimelinesArray=[],this.removeEventHandlers(),this},redraw:function(){this.reset().init()},getData:function(){return this.options.data},setData:function(a){this.options.data=a,this.redraw()}},a.fn[f]=function(b){return this.each(function(){return a.data(this,f)||a.data(this,f,new e(this,b)),this})}}(jQuery,window,document);
//# sourceMappingURL=multi-timeline.min.js.map