!function(a,b,c,d){function e(b,c){return this.element=b,this.$element=a(b),this.options=a.extend({},g,c),this._defaults=g,this._name=f,this._zoom=5,this._layerCount=0,this.init(),5!=this.options.zoom&&this.setZoom(this.options.zoom),this}var f="multiTimeline",g={start:moment().subtract(7,"days").format("YYYY-MM-DD"),end:moment().add(7,"days").format("YYYY-MM-DD"),dateFormat:"DD/MM",timelineSpacing:30,zoomStep:1,zoom:5,maxLabelCount:20,infinity:"9999-12-31",dawn:"0000-01-01",data:[],onTimelineClick:function(){},onZoomChange:function(){},zoomInControl:null,zoomOutControl:null,goLeftControl:null,goRightControl:null};e.prototype={init:function(){return null===this.options.start||null===this.options.end?(console.error("multi-timeline.js: start or end date is missing!"),!1):(this._startMoment=moment(this.options.start),this._endMoment=moment(this.options.end),this._endMoment.isAfter(this._startMoment)?(this._daysCount=this.getDuration(this._startMoment,this._endMoment),this._percentagePerDay=100/(this._daysCount+1),this._timelineCount=this.options.data.length,void this.createStructure().addTimelines().addEventHandlers().setWrapperDimensions()):(console.error("multi-timline.js: end date has to be a date after start date!"),!1))},createStructure:function(){return this.$element.addClass("tl-wrapper"),this.addMarks(),this},addMarks:function(){for(var b=this._startMoment,c=this._endMoment.add(1,"day"),d=a('<ul class="tl-time">'),e=-1,f="";!b.isSame(c);)e++,b=b.add(1,"day"),f=b,this._daysCount>10&&e%Math.round(this._daysCount/this.options.maxLabelCount)!==0&&(f=""),this.addTimeUnit(d,f,e+1);d.appendTo(this.$element)},addTimeUnit:function(b,c,d){var e=!1;moment.isMoment(c)&&(c=c.format(this.options.dateFormat),e=c===moment().format(this.options.dateFormat));var f=a('<li class="tl-time__unit">').html(c).css({left:d*this._percentagePerDay+"%"}).append("<span>");e&&f.addClass("is-today"),f.appendTo(b)},getDuration:function(a,b){var c=moment.duration(b.diff(a));return c.asDays()},addTimelines:function(){var b=this,c=0;return a(this.options.data).each(function(){var e=this;e.end==d&&(e.end=b.options.infinity),e.start==d&&(e.start=b.options.dawn);var f,g=b.getDuration(moment(e.start),moment(e.end)),h=b.getDuration(moment(b.options.start),moment(e.start));e.layer===d?(f=c,c++):f=e.layer;var i="",j="";0>h&&(g+=h,h=0,i="tl-overflow-left");var k=g*b._percentagePerDay;h+g>b._daysCount+1&&(j="tl-overflow-right",k=100);var l=h*b._percentagePerDay;h>b._daysCount+1&&(l=100);var m=0>g?"hidden":"visible",n=e.title!==d?e.title:"&nbsp;";a('<div class="tl-timeline">').html('<div class="tl-timeline__title">'+n+"</div>").css({width:k+"%",left:l+"%",visibility:m,bottom:f*b.options.timelineSpacing+20+"px","background-color":e.color!==d?e.color:null,"z-index":e.zIndex!==d?e.zIndex:10}).addClass(i+" "+j+" "+(e["class"]!==d?e["class"]:"")).attr({"data-startOffset":h,"data-duration":g,title:n}).on("click",function(a){b.options.onTimelineClick(a,e)}).prependTo(b.$element)}),this._layerCount=c,this},setWrapperDimensions:function(){var a=parseInt(this.$element.find(".tl-timeline:first").outerHeight()),b=this.$element.find(".tl-timeline").length||1;this.$element.css("height",a+b*this.options.timelineSpacing)},addEventHandlers:function(){var a=this;return null!==this.options.zoomInControl&&this.options.zoomInControl.on("click",function(b){a.zoomIn(),b.preventDefault()}),null!==this.options.zoomOutControl&&this.options.zoomOutControl.on("click",function(b){a.zoomOut(),b.preventDefault()}),null!==this.options.goRightControl&&this.options.goRightControl.on("click",function(b){a.goRight(),b.preventDefault()}),null!==this.options.goLeftControl&&this.options.goLeftControl.on("click",function(b){a.goLeft(),b.preventDefault()}),this},removeEventHandlers:function(){return null!==this.options.zoomInControl&&this.options.zoomInControl.off("click"),null!==this.options.zoomOutControl&&this.options.zoomOutControl.off("click"),null!==this.options.goRightControl&&this.options.goRightControl.off("click"),null!==this.options.goLeftControl&&this.options.goLeftControl.off("click"),this},setZoom:function(a){if(!(0>a)){var b=this._zoom-a;b>0?this.zoomIn(b):0>b&&this.zoomOut(Math.abs(b))}},zoomOut:function(a){a===d&&(a=1),this.options.start=moment(this.options.start).subtract(a*this.options.zoomStep,"days").format("YYYY-MM-DD"),this.options.end=moment(this.options.end).add(a*this.options.zoomStep,"days").format("YYYY-MM-DD"),this._zoom=this._zoom+a,this.options.onZoomChange(this._zoom),this.reset().init()},zoomIn:function(a){a===d&&(a=1);var b=moment(this.options.start).add(a*this.options.zoomStep,"days"),c=moment(this.options.end).subtract(a*this.options.zoomStep,"days");b.isBefore(c)&&(this.options.start=b.format("YYYY-MM-DD"),this.options.end=c.format("YYYY-MM-DD"),this._zoom=this._zoom-a,this.options.onZoomChange(this._zoom),this.reset().init())},goRight:function(){var a=Math.round(this._daysCount/12);this.options.start=moment(this.options.start).add(a,"days").format("YYYY-MM-DD"),this.options.end=moment(this.options.end).add(a,"days").format("YYYY-MM-DD"),this.reset().init()},goLeft:function(){var a=Math.round(this._daysCount/12);this.options.start=moment(this.options.start).subtract(a,"days").format("YYYY-MM-DD"),this.options.end=moment(this.options.end).subtract(a,"days").format("YYYY-MM-DD"),this.reset().init()},reset:function(){return this.$element.html(""),this.removeEventHandlers(),this}},a.fn[f]=function(b){return this.each(function(){return a.data(this,f)||a.data(this,f,new e(this,b)),this})}}(jQuery,window,document);